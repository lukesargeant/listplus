!function(e){e.widget("widgetplus.listplus",{version:"0.9.1",options:{filterBy:null,filterMode:"loose",filterTransform:"[^\\w ]",groupBy:null,hideList:null,persistentGroups:null,sortBy:null,ungroupableItemGroup:"Misc."},_create:function(){this.element.addClass("listplus")},_init:function(){this.refresh()},refresh:function(){var e=this;e.element.find(".ui-hidden").removeClass("ui-hidden"),e._ungroup(),e.options.filterBy&&e.filterBy(e.options.filterBy),e.options.sortBy&&e.sortBy(e.options.sortBy),e.options.groupBy&&e.groupBy(e.options.groupBy),e.options.hideList&&e.hideList(e.options.hideList)},filterBy:function(t){var i=this,n=i.element.children(),s=new RegExp(this.options.filterTransform,"g");if(n.data("listplus-filterscore",0),"string"===e.type(t)&&(t=[t]),"array"===e.type(t)){for(var r=0;r<t.length;r++)n.each(function(){var i=e(this),n=t[r].toLowerCase().replace(s,""),o=i.text().toLowerCase().replace(s,"");if(o.indexOf(n)>=0){var l=i.data("listplus-filterscore")+1;i.data("listplus-filterscore",l)}});var o=t.length;if(o>0){var l="strict"===i.options.filterMode?o:1;n.each(function(){var t=e(this);t.data("listplus-filterscore")<l&&t.addClass("ui-hidden")})}}},sortBy:function(t){var i=this;if(("string"===e.type(t)||"object"===e.type(t)||"function"===e.type(t))&&(t=[t]),"array"===e.type(t))for(var n=0;n<t.length;n++)i._sort(t[n],i.element)},_sort:function(t,i){var n=this,s=[],r=!1;i.children().each(function(){var i="";"object"===e.type(t)&&(r=t.reverse,t=t.sortValue),i="function"===e.type(t)?t(this):e(this).find(t).text(),s.push([this,i])});var o=n._sortAlphabetic;o=s.length>0&&"number"===e.type(s[0][1])?r?n._sortReverseNumeric:n._sortNumeric:r?n._sortReverseAlphabetic:n._sortAlphabetic;for(var s=this._mergeSort(s,o),l=0;l<s.length;l++)i.append(s[l][0])},_mergeSort:function(e,t){if(e.length<2)return e;var i=Math.ceil(e.length/2);return this._merge(this._mergeSort(e.slice(0,i),t),this._mergeSort(e.slice(i),t),t)},_merge:function(e,t,i){for(var n=new Array;e.length>0&&t.length>0;)i(e[0],t[0])<=0?n.push(e.shift()):n.push(t.shift());for(;e.length>0;)n.push(e.shift());for(;t.length>0;)n.push(t.shift());return n},_sortAlphabetic:function(e,t){return t[1]?e[1]?e[1]<t[1]?-1:e[1]>t[1]?1:0:1:-1},_sortReverseAlphabetic:function(e,t){return t[1]?e[1]?e[1]<t[1]?1:e[1]>t[1]?-1:0:1:-1},_sortNumeric:function(e,t){return e[1]-t[1]},_sortReverseNumeric:function(e,t){return t[1]-e[1]},groupBy:function(){var e=this;e._group()},_group:function(){var t=this;"array"===e.type(t.options.persistentGroups)&&e.each(t.options.persistentGroups,function(i,n){e("<li/>").text(n).addClass("listplus-heading").appendTo(t.element)}),t.element.children("li").not(".listplus-heading").each(function(){t._placeInGroup(this)})},_placeInGroup:function(t){var i=this,n=e.trim(e(t).find(i.options.groupBy).text());n=n||i.options.ungroupableItemGroup;var s=i.element.find('.listplus-heading:contains("'+n+'")');0==s.length&&(s=e("<li/>").text(n).addClass("listplus-heading").appendTo(i.element)),i.element.append(t)},_ungroup:function(){var e=this;e.element.children(".listplus-heading").remove()},hideList:function(t){var i=this;if("string"===e.type(t)&&(t=[t]),"array"===e.type(t))for(var n=0;n<t.length;n++)i.element.find(t[n]).addClass("ui-hidden")},pushItems:function(t){var i=this,n=e(t).hide().addClass("listplus-adding");i.element.append(n),i.refresh(),i.element.find(".listplus-adding").slideDown(200).promise().done(function(){i.element.find(".listplus-adding").removeClass("listplus-adding")})},removeItem:function(e){var t=this,i=t.element.find(e).closest("li");i.addClass("listplus-removing").slideUp(200).promise().done(function(){i.remove(),t._checkForEmptyGroups()})},_destroy:function(){var e=this;e.element.children(".listplus-heading").remove(),e.element.removeClass("listplus"),e.element.find(e.options.groupBy).show()},_setOptions:function(){this._superApply(arguments),this.refresh()},_setOption:function(e,t){this._super(e,t)}})}(jQuery);