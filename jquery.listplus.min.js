!function($){$.widget("widgetplus.listplus",{version:"1.0.0",options:{filterBy:null,filterMode:"loose",filterTransform:"[^\\w ]",groupBy:null,hideList:null,persistentGroups:null,sortBy:null,ungroupableItemGroup:"Misc."},_create:function(){this.element.addClass("listplus")},_init:function(){this.refresh()},refresh:function(){var widget=this;widget.element.find(".ui-hidden").removeClass("ui-hidden"),widget._ungroup(),widget.options.filterBy&&widget.filterBy(widget.options.filterBy),widget.options.sortBy&&widget.sortBy(widget.options.sortBy),widget.options.groupBy&&widget.groupBy(widget.options.groupBy),widget.options.hideList&&widget.hideList(widget.options.hideList)},filterBy:function(filterArr){var widget=this,$listitems=widget.element.children(),transform=new RegExp(this.options.filterTransform,"g");if($listitems.data("listplus-filterscore",0),"string"===$.type(filterArr)&&(filterArr=[filterArr]),"array"===$.type(filterArr)){for(var bestScore=0,i=0;i<filterArr.length;i++)$listitems.each(function(){var $this=$(this),filterTerm=filterArr[i].toLowerCase().replace(transform,""),filterRow=$this.text().toLowerCase().replace(transform,"");if(filterRow.indexOf(filterTerm)>=0){var newScore=$this.data("listplus-filterscore")+1;$this.data("listplus-filterscore",newScore),newScore>bestScore&&(bestScore=newScore)}});var numberOfFilterWords=filterArr.length;if(numberOfFilterWords>0){var requiredScore=1;"strict"===widget.options.filterMode?requiredScore=numberOfFilterWords:"best"===widget.options.filterMode&&(requiredScore=bestScore),$listitems.each(function(){var $this=$(this);$this.data("listplus-filterscore")<requiredScore&&$this.addClass("ui-hidden")})}widget._trigger("filter",null,{})}},sortBy:function(sortArr){var widget=this;if(("string"===$.type(sortArr)||"object"===$.type(sortArr)||"function"===$.type(sortArr))&&(sortArr=[sortArr]),"array"===$.type(sortArr)){for(var i=0;i<sortArr.length;i++)widget._sort(sortArr[i],widget.element);widget._trigger("sort",null,{})}},_sort:function(sortOb,$context){var widget=this,sortingArray=[],reverse=!1;$context.children().each(function(){var thisSortValue="";"object"===$.type(sortOb)&&(reverse=sortOb.reverse,sortOb=sortOb.sortValue),thisSortValue="function"===$.type(sortOb)?sortOb(this):$(this).find(sortOb).text(),sortingArray.push([this,thisSortValue])});var sortFunction=widget._sortAlphabetic;sortFunction=sortingArray.length>0&&"number"===$.type(sortingArray[0][1])?reverse?widget._sortReverseNumeric:widget._sortNumeric:reverse?widget._sortReverseAlphabetic:widget._sortAlphabetic;for(var sortingArray=this._mergeSort(sortingArray,sortFunction),i=0;i<sortingArray.length;i++)$context.append(sortingArray[i][0])},_mergeSort:function(array,comparison){if(array.length<2)return array;var middle=Math.ceil(array.length/2);return this._merge(this._mergeSort(array.slice(0,middle),comparison),this._mergeSort(array.slice(middle),comparison),comparison)},_merge:function(left,right,comparison){for(var result=new Array;left.length>0&&right.length>0;)comparison(left[0],right[0])<=0?result.push(left.shift()):result.push(right.shift());for(;left.length>0;)result.push(left.shift());for(;right.length>0;)result.push(right.shift());return result},_sortAlphabetic:function(a,b){return b[1]?a[1]?a[1]<b[1]?-1:a[1]>b[1]?1:0:1:-1},_sortReverseAlphabetic:function(a,b){return b[1]?a[1]?a[1]<b[1]?1:a[1]>b[1]?-1:0:1:-1},_sortNumeric:function(a,b){return a[1]-b[1]},_sortReverseNumeric:function(a,b){return b[1]-a[1]},groupBy:function(){var widget=this;widget._group()},_group:function(){var widget=this;"array"===$.type(widget.options.persistentGroups)&&$.each(widget.options.persistentGroups,function(i,v){$("<li/>").text(v).addClass("listplus-heading").appendTo(widget.element)}),widget.element.children("li").not(".listplus-heading").each(function(){widget._placeInGroup(this)}),widget._trigger("group",null,{})},_placeInGroup:function(listitem){var widget=this,groupheading=$.trim($(listitem).find(widget.options.groupBy).text());groupheading=groupheading||widget.options.ungroupableItemGroup;var $groupheading=widget.element.find('.listplus-heading:contains("'+groupheading+'")');0==$groupheading.length&&($groupheading=$("<li/>").text(groupheading).addClass("listplus-heading").appendTo(widget.element)),widget.element.append(listitem)},_ungroup:function(){var widget=this;widget.element.children(".listplus-heading").remove()},hideList:function(hideArr){var widget=this;if("string"===$.type(hideArr)&&(hideArr=[hideArr]),"array"===$.type(hideArr))for(var i=0;i<hideArr.length;i++)widget.element.find(hideArr[i]).addClass("ui-hidden")},pushItems:function(listitems){var widget=this,$li=$(listitems).hide().addClass("listplus-adding");widget.element.append($li),widget.refresh(),widget.element.find(".listplus-adding").slideDown(200).promise().done(function(){widget.element.find(".listplus-adding").removeClass("listplus-adding")})},removeItem:function(selector){var widget=this,$listitem=widget.element.find(selector).closest("li");$listitem.addClass("listplus-removing").slideUp(200).promise().done(function(){$listitem.remove(),widget._checkForEmptyGroups()})},_destroy:function(){var widget=this;widget.element.children(".listplus-heading").remove(),widget.element.removeClass("listplus"),widget.element.find(widget.options.groupBy).show()},_setOptions:function(){this._superApply(arguments),this.refresh()},_setOption:function(key,value){this._super(key,value)}})}(jQuery);